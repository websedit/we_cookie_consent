<f:section name="Header">
    <f:if condition="{settings.klaro.consentMode} || {settings.klaro.consentModev2}">
        <f:then>
            <script>
                // Define dataLayer and the gtag function.
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}

                // Set default consent to 'denied' as a placeholder
                // Determine actual values based on your own requirements
                gtag('consent', 'default', {
                    'ad_storage': 'denied',
                    'analytics_storage': 'denied',
                    'ad_user_data': 'denied',
                    'ad_personalization': 'denied',
                    'functionality_storage': 'denied',
                    'personalization_storage': 'denied',
                    'security_storage': 'granted',
                    'wait_for_update': 500
                });
            </script>

            <f:if condition="{settings.klaro.consentModev2}">
                <!-- Google tag (gtag.js) -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=<f:format.raw>{service.apiKey}</f:format.raw>">
                </script>
                <script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}

                    gtag('js', new Date());
                    gtag('config', '<f:format.raw>{service.apiKey}</f:format.raw>');
                    //Enable ads_data_redaction by default
					gtag('set', 'ads_data_redaction', true);
                </script>

                <script type="opt-in" data-type="text/javascript" data-name="{service.provider}-{service.uid}">
                    if({service.adStorage} != 0) {
                        consenTypeObj.ad_storage = "{f:if(condition:'{service.adStorage}==1', then:'granted', else:'{f:if(condition:\'{service.adStorage}==2\', then:\'denied\')}')}";
                    }
                    if({service.analyticsStorage} != 0) {
                        consenTypeObj.analytics_storage = "{f:if(condition:'{service.analyticsStorage}==1', then:'granted', else:'{f:if(condition:\'{service.analyticsStorage}==2\', then:\'denied\')}')}";
                    }
                    if({service.adUserData} != 0) {
                        consenTypeObj.ad_user_data = "{f:if(condition:'{service.adUserData}==1', then:'granted', else:'{f:if(condition:\'{service.adUserData}==2\', then:\'denied\')}')}";
                    }
                    if({service.adPersonalization} != 0) {
                        consenTypeObj.ad_personalization = "{f:if(condition:'{service.adPersonalization}==1', then:'granted', else:'{f:if(condition:\'{service.adPersonalization}==2\', then:\'denied\')}')}";
                    }
                    if({service.functionalityStorage} != 0) {
                        consenTypeObj.functionality_storage = "{f:if(condition:'{service.functionalityStorage}==1', then:'granted', else:'{f:if(condition:\'{service.functionalityStorage}==2\', then:\'denied\')}')}";
                    }
                    if({service.personalizationStorage} != 0) {
                        consenTypeObj.personalization_storage = "{f:if(condition:'{service.personalizationStorage}==1', then:'granted', else:'{f:if(condition:\'{service.personalizationStorage}==2\', then:\'denied\')}')}";
                    }
                    if({service.securityStorage} != 0) {
                        consenTypeObj.security_storage = "{f:if(condition:'{service.securityStorage}==1', then:'granted', else:'{f:if(condition:\'{service.securityStorage}==2\', then:\'denied\')}')}";
                    }

                    gtag('consent', 'update', consenTypeObj);
                </script>
            </f:if>
            <f:if condition="{settings.klaro.consentMode}">
                <script>
                    gtag('js', new Date());
                    gtag('config', '<f:format.raw>{service.apiKey}</f:format.raw>');
					//Enable ads_data_redaction by default
					gtag('set', 'ads_data_redaction', true);
                </script>
                <script type="opt-in" data-type="text/javascript" data-name="{service.provider}-{service.uid}">
                    function gtag() { dataLayer.push(arguments); }

                    if({service.adStorage} != 0) {
                        consenTypeObj.ad_storage = "{f:if(condition:'{service.adStorage}==1', then:'granted', else:'{f:if(condition:\'{service.adStorage}==2\', then:\'denied\')}')}";
                    }
                    if({service.analyticsStorage} != 0) {
                        consenTypeObj.analytics_storage = "{f:if(condition:'{service.analyticsStorage}==1', then:'granted', else:'{f:if(condition:\'{service.analyticsStorage}==2\', then:\'denied\')}')}";
                    }
                    if({service.adUserData} != 0) {
                        consenTypeObj.ad_user_data = "{f:if(condition:'{service.adUserData}==1', then:'granted', else:'{f:if(condition:\'{service.adUserData}==2\', then:\'denied\')}')}";
                    }
                    if({service.adPersonalization} != 0) {
                        consenTypeObj.ad_personalization = "{f:if(condition:'{service.adPersonalization}==1', then:'granted', else:'{f:if(condition:\'{service.adPersonalization}==2\', then:\'denied\')}')}";
                    }
                    if({service.functionalityStorage} != 0) {
                        consenTypeObj.functionality_storage = "{f:if(condition:'{service.functionalityStorage}==1', then:'granted', else:'{f:if(condition:\'{service.functionalityStorage}==2\', then:\'denied\')}')}";
                    }
                    if({service.personalizationStorage} != 0) {
                        consenTypeObj.personalization_storage = "{f:if(condition:'{service.personalizationStorage}==1', then:'granted', else:'{f:if(condition:\'{service.personalizationStorage}==2\', then:\'denied\')}')}";
                    }
                    if({service.securityStorage} != 0) {
                        consenTypeObj.security_storage = "{f:if(condition:'{service.securityStorage}==1', then:'granted', else:'{f:if(condition:\'{service.securityStorage}==2\', then:\'denied\')}')}";
                    }

                    gtag('consent', 'update', consenTypeObj);

                    // Load gtag.js script.
                    var gtagScript = document.createElement('script');
                    gtagScript.async = true;
                    gtagScript.src = 'https://www.googletagmanager.com/gtag/js?id=<f:format.raw>{service.apiKey}</f:format.raw>';

                    var firstScript = document.getElementsByTagName('script')[0];
                    firstScript.parentNode.insertBefore(gtagScript,firstScript);
                </script>
            </f:if>
        </f:then>
        <f:else>
            <!-- Google Analytics -->
            <script type="opt-in" data-type="text/javascript" data-name="{service.provider}-{service.uid}">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', '{service.apiKey}', 'auto');
                ga('set', 'anonymizeIp', true);
                ga('send', 'pageview');
            </script>
            <!-- End Google Analytics -->
        </f:else>
    </f:if>
</f:section>
<f:section name="Footer" />